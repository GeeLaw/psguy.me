<!DOCTYPE html>
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/assets/styles/github-markdown.css" rel="stylesheet" type="text/css">
    <link href="/assets/styles/gl-float.css" rel="stylesheet" type="text/css">
    <link href="/assets/styles/gl-accessible.css" rel="stylesheet" type="text/css">
    <link href="/assets/styles/gl-frame.css" rel="stylesheet" type="text/css">
<title>Sign-Scripts</title></head>
<body>
    <header class="gl-navbar">
    <a href=".">CommonUtilities</a><a href="https://github.com/GeeLaw/psguy.me/tree/master/modules/CommonUtilities" target="_blank">Repository</a></header>
    <div class="gl-contentview">
        <article class="markdown-body" id="content">
            <div>
                <h1>
Sign-Scripts</h1>

<p>Use <code>Sign-Scripts [-Scripts] &lt;string[]&gt; [[-Certificate] &lt;X509Certificate2&gt;]</code> to sign your scripts. It is recommended that you set the execution policy to <code>AllSigned</code> to prevent (potentially) malicious scripts from running while provide yourself with convenience. To do so, you have to first create a root certificate using <a href="https://msdn.microsoft.com/en-us/library/bfsktky3(VS.80).aspx">makecert utility</a> in <strong>elevated</strong> PowerShell:</p>

<div class="highlight highlight-source-powershell"><pre>makecert <span class="pl-k">-</span>n <span class="pl-s">"CN=PowerShell Local Certificate Root"</span> <span class="pl-k">-</span>a sha1 <span class="pl-k">-</span>eku <span class="pl-c1"><span class="pl-c1">1.3</span></span>.<span class="pl-c1"><span class="pl-c1">6.1</span></span>.<span class="pl-c1"><span class="pl-c1">5.5</span></span>.<span class="pl-c1"><span class="pl-c1">7.3</span></span>.<span class="pl-c1"><span class="pl-c1">3</span></span> <span class="pl-k">-</span>r <span class="pl-k">-</span>sv root.pvk root.cer <span class="pl-k">-</span>ss Root <span class="pl-k">-</span>sr localMachine <span class="pl-k">-</span>b <span class="pl-c1"><span class="pl-c1">4</span></span><span class="pl-k">/</span><span class="pl-c1"><span class="pl-c1">1</span></span><span class="pl-k">/</span><span class="pl-c1"><span class="pl-c1">2016</span></span> <span class="pl-k">-</span>e <span class="pl-c1"><span class="pl-c1">1</span></span><span class="pl-k">/</span><span class="pl-c1"><span class="pl-c1">1</span></span><span class="pl-k">/</span><span class="pl-c1"><span class="pl-c1">2020</span></span></pre></div>

<p>After creating the root certificate, create a code signing certificate from it:</p>

<div class="highlight highlight-source-powershell"><pre>makecert <span class="pl-k">-</span>pe <span class="pl-k">-</span>n <span class="pl-s">"CN=PowerShell Code Signing"</span> <span class="pl-k">-</span>ss MY <span class="pl-k">-</span>a sha1 <span class="pl-k">-</span>eku <span class="pl-c1"><span class="pl-c1">1.3</span></span>.<span class="pl-c1"><span class="pl-c1">6.1</span></span>.<span class="pl-c1"><span class="pl-c1">5.5</span></span>.<span class="pl-c1"><span class="pl-c1">7.3</span></span>.<span class="pl-c1"><span class="pl-c1">3</span></span> <span class="pl-k">-</span>iv root.pvk <span class="pl-k">-</span>ic root.cer</pre></div>

<p>You have to enter a password to protect the key. After creation, verify the installation by the following command:</p>

<div class="highlight highlight-source-powershell"><pre><span class="pl-c1">Get-ChildItem</span> Cert:\CurrentUser\My <span class="pl-k">-</span>CodeSigningCert</pre></div>

<p>If there is at least one certificate, you're done.</p>

<p>If you have not supplied a certificate, <code>Sign-Scripts</code> cmdlet signs the scripts with the certificate you specify interactively. Furthermore, if you have only one code-signing certificate, the cmdlet silently signs all the specified scripts with that certificate.</p>

<p>You might get prompted to trust a certificate when you run a signed script for the first time, answering <code>A</code> (Always run) will add the certificate to trsuted publishers so that you do not have to confirm every time.</p>

            </div>
        </article>
        <footer class="markdown-body">
            <p>Copyright Â© 2016 by Gee Law. All rights reserved.</p>
        </footer>
    </div>
    <iframe class="gl-accessibility-helper-iframe">
    </iframe>
    <script src="/assets/scripts/gl-frame.js" type="text/javascript"></script>


</body></html>
